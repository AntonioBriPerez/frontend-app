<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>DevOps Secure Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: monospace; }
        .terminal { background-color: #000; border: 1px solid #334155; height: 400px; overflow-y: auto; }
        /* Efecto de bot√≥n presionado */
        .btn { transition: transform 0.1s; }
        .btn:active { transform: scale(0.95); }
        /* Scrollbar personalizada */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    </style>
</head>
<body>
    <div id="app" class="container mx-auto p-10">
        <h1 class="text-3xl mb-8 font-bold text-green-500">üõ°Ô∏è AntonioAuth System v1.0</h1>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="space-y-6">
                
                <div class="p-6 bg-slate-800 rounded-lg border border-slate-700 shadow-lg">
                    <h2 class="text-xl mb-4 text-blue-400 font-bold">1. Autenticaci√≥n (OAuth Server)</h2>
                    <p class="text-sm text-slate-400 mb-4">Solicita un JWT firmado (RS256) al puerto 8080.</p>
                    
                    <button @click="login" :disabled="loading" class="btn w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50">
                        üîê Obtener Token
                    </button>
                    
                    <div v-if="token" class="mt-4">
                        <label class="text-xs text-gray-500">Access Token (JWT):</label>
                        <div class="p-2 bg-slate-900 text-green-400 text-xs break-all rounded border border-green-900 font-mono">
                            {{ token }}
                        </div>
                    </div>
                </div>

                <div class="p-6 bg-slate-800 rounded-lg border border-slate-700 shadow-lg transition-opacity duration-300" 
                     :class="{'opacity-50': !token, 'opacity-100': token}">
                    <h2 class="text-xl mb-4 text-purple-400 font-bold">2. Recurso Protegido (Python API)</h2>
                    <p class="text-sm text-slate-400 mb-4">Usa el token para pedir datos secretos al puerto 3000.</p>
                    
                    <button @click="getDashboard" :disabled="!token || loading" class="btn w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50 disabled:cursor-not-allowed">
                        üöÄ Consultar API
                    </button>
                    
                    <div v-if="dashboardData" class="mt-4 p-4 bg-slate-900 rounded border border-purple-900">
                        <pre class="text-green-300 text-sm overflow-x-auto">{{ dashboardData }}</pre>
                    </div>
                </div>

            </div>

            <div>
                <h2 class="text-xl mb-2 text-gray-400 font-bold">üìü Live System Logs</h2>
                <div class="terminal p-4 rounded text-sm font-mono shadow-xl relative">
                    <div v-if="logs.length === 0" class="text-gray-600 italic absolute top-4 left-4">Esperando acciones...</div>
                    <div v-for="(log, index) in logs" :key="index" class="mb-1 border-b border-gray-900 pb-1">
                        <span class="text-gray-500">[{{ log.time }}]</span>
                        <span :class="log.color">{{ log.message }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    token: '',
                    dashboardData: null,
                    loading: false,
                    logs: [],
                    // Apuntamos a los t√∫neles locales (Port Forwarding)
                    oauthUrl: 'http://localhost:8080/token',
                    apiUrl: 'http://localhost:3000/dashboard'
                }
            },
            methods: {
                addLog(msg, type = 'info') {
                    const time = new Date().toLocaleTimeString();
                    let color = 'text-gray-300';
                    if (type === 'success') color = 'text-green-400 font-bold';
                    if (type === 'error') color = 'text-red-400 font-bold';
                    if (type === 'warn') color = 'text-yellow-400';
                    this.logs.unshift({ time, message: msg, color });
                },
                async login() {
                    this.loading = true;
                    this.addLog("üöÄ Iniciando flujo OAuth Client Credentials...", 'warn');
                    this.addLog(`üì° POST ${this.oauthUrl}`);
                    
                    try {
                        const response = await fetch(this.oauthUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                client_id: "mi-app-python", 
                                client_secret: "secreto_super_seguro",
                                grant_type: "client_credentials"
                            })
                        });

                        if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                        
                        const data = await response.json();
                        this.token = data.access_token;
                        this.addLog("‚úÖ Token JWT firmado recibido.", 'success');
                    } catch (e) {
                        this.addLog(`‚ùå Error en Login: ${e.message}`, 'error');
                        if (e.message.includes("Failed to fetch")) {
                            this.addLog("üí° Consejo: Verifica que el t√∫nel al puerto 8080 est√© abierto.", 'warn');
                        }
                    } finally {
                        this.loading = false;
                    }
                },
                async getDashboard() {
                    this.loading = true;
                    this.addLog("üöÄ Solicitando acceso al Dashboard Python...", 'warn');
                    this.addLog(`üõ°Ô∏è Header: Authorization Bearer ...`);
                    
                    try {
                        const response = await fetch(this.apiUrl, {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${this.token}`
                            }
                        });

                        if (!response.ok) {
                            if (response.status === 401) this.addLog("‚õî 401: Token inv√°lido o expirado", 'error');
                            else throw new Error(`HTTP ${response.status}`);
                            return;
                        }

                        const data = await response.json();
                        this.dashboardData = data;
                        this.addLog("‚úÖ Acceso Concedido. JSON recibido.", 'success');
                    } catch (e) {
                        this.addLog(`‚ùå Error API: ${e.message}`, 'error');
                         if (e.message.includes("Failed to fetch")) {
                            this.addLog("üí° Consejo: Verifica que el t√∫nel al puerto 3000 est√© abierto.", 'warn');
                        }
                    } finally {
                        this.loading = false;
                    }
                }
            }
        }).mount('#app')
    </script>
</body>
</html>